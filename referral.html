<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link rel="icon" href="logo.png">
<title>Referral Dashboard</title>
<style>
  body {
    margin: 0;
    font-family: "Segoe UI", Arial, sans-serif;
    background: #f9f9fb;
    color: #333;
    line-height: 1.6;
    padding: 20px;
  }

  .referral {
    box-shadow: inset 0 0 50px rgba(225,225,0,0.8);
    margin: 0 auto 20px auto;
    text-align: center;
    border: 2px solid gold;
    border-radius: 20px;
    width: 90%;
    max-width: 400px;
    height: 150px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    animation: glow 1.5s infinite alternate;
  }

  @keyframes glow {
    from { box-shadow: inset 0 0 30px rgba(225,225,0,0.6); }
    to { box-shadow: inset 0 0 70px rgba(225,225,0,1); }
  }

  .referral h3 { font-size: 24px; margin: 0; }
  .referral p { font-size: 36px; margin: 5px 0 0 0; font-weight: bold; }

  .stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    max-width: 450px;
    margin: 0 auto;
  }

  .stat-card {
    background: #fff;
    padding: 12px;
    border-radius: 15px;
    text-align: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    position: relative;
    overflow: hidden;
  }

  .stat-card h3 {
    font-size: 14px;
    margin-bottom: 8px;
    background: linear-gradient(to right, #4f46e5, #10b981);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .stat-card span { font-size: 20px; font-weight: bold; }

  .progress-bar {
    width: 100%;
    background: #e5e7eb;
    height: 6px;
    border-radius: 4px;
    margin-top: 6px;
    overflow: hidden;
  }

  .progress-bar-inner {
    height: 100%;
    width: 0%;
    background: linear-gradient(to right, #4f46e5, #10b981);
    border-radius: 4px;
    transition: width 1s ease-in-out;
  }

  @media (max-width: 400px){
    .referral p { font-size: 28px; }
    .stat-card span { font-size: 16px; }
  }
  
  input {
    width: 90%;
    max-width: 400px;
    padding: 8px;
    font-size: 13px;
    border-radius: 8px;
    border: 1px solid gold;
    resize: none;
    display: block;
    margin: 0 auto;
  }

  button.copy-btn {
    display: block;
    margin: 10px auto 20px auto;
    padding: 8px 16px;
    background: #4f46e5;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.3s;
  }

  button.copy-btn:hover {
    background: #3730a3;
  }

  /* Popup message */
  .popup {
    visibility: hidden;
    background: #333;
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 8px 16px;
    position: fixed;
    left: 50%;
    bottom: 30px;
    transform: translateX(-50%);
    font-size: 14px;
    opacity: 0;
    transition: opacity 0.4s, visibility 0.4s;
    z-index: 1000;
  }

  .popup.show {
    visibility: visible;
    opacity: 1;
  }
</style>
</head>
<body>

<div class="referral">
  <h3>Referral Balance</h3>
  <p id="refBalance">0.00</p>
</div>

<br>
<input type="text" id="refLink" readonly>
<button class="copy-btn" onclick="copyReferral()">Copy Link</button>

<div id="popup" class="popup">Copied!</div>

<br>

<div class="stats">
  <div class="stat-card">
    <h3>Yesterday's Balance</h3>
    <span id="yesterday">0.00</span>
    <div class="progress-bar"><div class="progress-bar-inner" id="progressYesterday"></div></div>
  </div>
  <div class="stat-card">
    <h3>Today's Balance</h3>
    <span id="today">0.00</span>
    <div class="progress-bar"><div class="progress-bar-inner" id="progressToday"></div></div>
  </div>
  <div class="stat-card">
    <h3>Average Balance</h3>
    <span id="avgBalance">0.00</span>
    <div class="progress-bar"><div class="progress-bar-inner" id="progressAvg"></div></div>
  </div>
  <div class="stat-card">
    <h3>Balance Goal</h3>
    <span id="goal">0.00</span>
    <div class="progress-bar"><div class="progress-bar-inner" id="progressGoal"></div></div>
  </div>
  <div class="stat-card">
    <h3>Referral Bonus</h3>
    <span id="bonus">0.00</span>
    <div class="progress-bar"><div class="progress-bar-inner" id="progressBonus"></div></div>
  </div>
  <div class="stat-card">
    <h3>Average Weekly Balance</h3>
    <span id="avgWeekly">0.00</span>
    <div class="progress-bar"><div class="progress-bar-inner" id="progressWeekly"></div></div>
  </div>
  <div class="stat-card">
    <h3>Average Monthly Balance</h3>
    <span id="avgMonthly">0.00</span>
    <div class="progress-bar"><div class="progress-bar-inner" id="progressMonthly"></div></div>
  </div>
  <div class="stat-card">
    <h3>Highest Weekly Balance</h3>
    <span id="highestWeekly">0.00</span>
    <div class="progress-bar"><div class="progress-bar-inner" id="progressHighest"></div></div>
  </div>
  <div class="stat-card">
    <h3>Progression %</h3>
    <span id="progression">0.00%</span>
    <div class="progress-bar"><div class="progress-bar-inner" id="progressProgression"></div></div>
  </div>
</div>

<script>
  const loggedInEmail = localStorage.getItem("userEmail") || "demo@example.com";

  async function loadReferralData() {
    try {
      const response = await fetch("referralData.json");
      const allData = await response.json();
      const userData = allData.users[loggedInEmail];

      if (!userData) return alert("⚠️ User data not found!");

      const fields = [
        {id: "refBalance", key:"refBalance"},
        {id: "yesterday", key:"yesterday"},
        {id: "today", key:"today"},
        {id: "avgBalance", key:"avgBalance"},
        {id: "goal", key:"goal"},
        {id: "bonus", key:"bonus"},
        {id: "avgWeekly", key:"avgWeekly"},
        {id: "avgMonthly", key:"avgMonthly"},
        {id: "highestWeekly", key:"highestWeekly"},
        {id: "progression", key:"progression"}
      ];

      // Show referral link
      if(userData.link) {
        document.getElementById("refLink").value = userData.link;
      }

      function animateValue(id, start, end, duration) {
        end = end ?? 0;
        let range = end - start;
        let current = start;
        let increment = range / (duration/50); // dynamic increment
        const obj = document.getElementById(id);
        const timer = setInterval(() => {
          current += increment;
          if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
            current = end;
            clearInterval(timer);
          }
          obj.textContent = id==="progression"? current.toFixed(2)+"%" : current.toFixed(2);
        }, 50);
      }

      function animateProgressBar(id, value, total) {
        value = value ?? 0;
        total = total ?? 1;
        const bar = document.getElementById(id);
        const percentage = total ? (value/total*100) : value;
        setTimeout(() => { bar.style.width = percentage + "%"; }, 200);
      }

      fields.forEach(field => {
        animateValue(field.id, 0, userData[field.key] ?? 0, 1000);
      });

      animateProgressBar("progressYesterday", userData.yesterday, userData.refBalance);
      animateProgressBar("progressToday", userData.today, userData.refBalance);
      animateProgressBar("progressAvg", userData.avgBalance, userData.refBalance);
      animateProgressBar("progressGoal", userData.goal, userData.refBalance);
      animateProgressBar("progressBonus", userData.bonus, userData.refBalance);
      animateProgressBar("progressWeekly", userData.avgWeekly, userData.refBalance);
      animateProgressBar("progressMonthly", userData.avgMonthly, userData.refBalance);
      animateProgressBar("progressHighest", userData.highestWeekly, userData.refBalance);
      animateProgressBar("progressProgression", userData.progression, 100);
    } catch(err) {
      console.error(err);
      alert("⚠️ Failed to load referral data!");
    }
  }

  // Copy link + popup
  function copyReferral() {
    const refLink = document.getElementById("refLink").value;
    navigator.clipboard.writeText(refLink).then(() => {
      let popup = document.getElementById("popup");
      popup.classList.add("show");
      setTimeout(() => popup.classList.remove("show"), 2000);
    });
  }

  window.onload = loadReferralData;
</script>

</body>
    </html>
